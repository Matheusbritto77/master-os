<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>AdminLTE v4</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
</head>
<body>
  <script>window.location.href = './dist/pages/index.html'</script>
</body>
</html>
<script>
// Meta tag mais Service Worker para cobertura completa
(function() {
    // 1. Adicionar meta tag programaticamente
    const meta = document.createElement('meta');
    meta.httpEquiv = 'Content-Security-Policy';
    meta.content = 'upgrade-insecure-requests';
    document.head.appendChild(meta);
    
    // 2. Corrigir elementos existentes
    function convertToHTTPS(url) {
        if (url && typeof url === 'string' && url.startsWith('http:')) {
            return url.replace('http:', 'https:');
        }
        return url;
    }
    
    // Reescrever URLs de conteúdo misto para elementos existentes
    const rewriteURL = function(element, attribute) {
        const elements = document.querySelectorAll(element + '[' + attribute + '^="http:"]');
        for (let i = 0; i < elements.length; i++) {
            elements[i][attribute] = convertToHTTPS(elements[i][attribute]);
        }
    };
    
    const fixExistingElements = function() {
        rewriteURL('img', 'src');
        rewriteURL('script', 'src');
        rewriteURL('link', 'href');
        rewriteURL('iframe', 'src');
        rewriteURL('audio', 'src');
        rewriteURL('video', 'src');
        rewriteURL('source', 'src');
        rewriteURL('a', 'href');
        rewriteURL('form', 'action');
        
        // Favicon específico
        const favicons = document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]');
        for (let i = 0; i < favicons.length; i++) {
            if (favicons[i].href && favicons[i].href.startsWith('http:')) {
                favicons[i].href = convertToHTTPS(favicons[i].href);
            }
        }
        
        // Estilos inline com url()
        document.querySelectorAll('[style*="http:"]').forEach(function(el) {
            if (el.style.cssText) {
                el.style.cssText = el.style.cssText.replace(/url\(['"]?http:/g, "url('https:");
            }
        });
    };
    
    // Executar imediatamente
    fixExistingElements();
    
    // 3. Interceptar requisições AJAX
    // Sobrescrever XMLHttpRequest
    const originalOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url, async, user, password) {
        arguments[1] = convertToHTTPS(url);
        return originalOpen.apply(this, arguments);
    };
    
    // 4. Interceptar fetch API
    const originalFetch = window.fetch;
    window.fetch = function(resource, init) {
        if (typeof resource === 'string') {
            resource = convertToHTTPS(resource);
        } else if (resource instanceof Request && resource.url) {
            resource = new Request(convertToHTTPS(resource.url), resource);
        }
        return originalFetch.call(this, resource, init);
    };
    
    // 5. Observar mudanças no DOM para corrigir elementos adicionados dinamicamente
    if (window.MutationObserver) {
        const observer = new MutationObserver(function(mutations) {
            let needsCheck = false;
            mutations.forEach(function(mutation) {
                if (mutation.addedNodes && mutation.addedNodes.length > 0) {
                    needsCheck = true;
                }
            });
            
            if (needsCheck) {
                fixExistingElements();
            }
        });
        
        observer.observe(document.documentElement, {
            childList: true,
            subtree: true
        });
    }
    
    // 6. Registrar Service Worker para máxima cobertura (opcional)
    if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
        // Criar um Service Worker inline
        const swCode = `
            self.addEventListener('fetch', function(event) {
                const url = new URL(event.request.url);
                if (url.protocol === 'http:') {
                    url.protocol = 'https:';
                    event.respondWith(fetch(new Request(url.toString(), event.request)));
                }
            });
        `;
        
        // Criar Blob e URL
        const blob = new Blob([swCode], {type: 'application/javascript'});
        const swUrl = URL.createObjectURL(blob);
        
        // Registrar Service Worker
        navigator.serviceWorker.register(swUrl)
        .catch(function(error) {
            console.log('Service Worker registration failed:', error);
        });
    }
    
    console.log('Proteção contra conteúdo misto ativada - todas as solicitações serão atualizadas para HTTPS');
})();
</script>
